<!-- omit in toc -->
# コード実行手順書 
## コーディング課題：MNISTデータセットに対するディープラーニング学習と評価

## 1. ドキュメント作成者

ギマレンス　ゴンサルベス　ダニロ(daniloguimaraes71@gmail.com)

## 2. 改訂履歴

- 1.0:
  - 作成日時: 2023-08-23 13:48:45
  - 更新内容: 初版作成

## 3. このドキュメントの目次

- [1. ドキュメント作成者](#1-ドキュメント作成者)
- [2. 改訂履歴](#2-改訂履歴)
- [3. このドキュメントの目次](#3-このドキュメントの目次)
- [4. このドキュメントの目的・概要](#4-このドキュメントの目的概要)
- [5. 前提条件](#5-前提条件)
- [6. 準備](#6-準備)
    - [6.1. ソースコード準備](#61-作業完了条件)
    - [6.2. コンフィグファイルの設定](#62-作業完了条件)
- [7. 手順](#7-手順)
    - [7.1. 訓練コードの実行](#71-訓練コードの実行)
    - [7.2. テストコードの実行](#72-テストコードの実行)
    - [7.3. 評価コードを実行](#73-評価コードを実行)
- [8. その他](#8-その他)
    - [8.1. ログを確認する](#81-ログを確認する)
    - [8.2. 出力データフォーマット](#82-出力データフォーマット)
        - [8.2.1. モデルウェイト](#82-モデルウェイト)
        - [8.2.2. メトリクスファイルの保存](#82-メトリクスファイルの保存)

## 4. このドキュメントの目次概要

## 5. 前提条件

## 6. 準備

### 6.１．ソースコードの準備と展開

1. ソースコードのダウンロード：
   - プロジェクトのソースコードを適当な場所にダウンロードします。

2. 展開と実行：
   - ターミナルを開き、プロジェクトフォルダに移動します。
     ```console
     $ cd [プロジェクトフォルダのパス]
     ```
   - ソースコードを展開します。
     ```console
     $ unzip -o source_code.zip
     ```

### 6.2．コンフィグファイルの設定

- プロジェクトフォルダで`config/config.json`ファイルをテキストエディタで開きます。
- 以下のパラメーターを調整します。各設定はプロジェクトの要件に合わせて調整します。

```json
{
    "batch_size": [バッチサイズ],
    "learning_rate": [学習率],
    "epochs": [エポック数],
    "log_dir": "[ログの保存先]",
    "model_save_dir": "[モデルの保存先]"
}
```
パラメーターの詳細：

| パラメタ名       | 説明                                                         |
| --------------- | ------------------------------------------------------------ |
| `batch_size`    | バッチサイズ：トレーニングやテスト時に使用するバッチのサイズ。 |
| `learning_rate` | 学習率：モデルの重みを更新する際のステップサイズ。            |
| `epochs`        | エポック数：トレーニングデータ全体を何回使用するかを指定する回数。 |
| `log_dir`       | ログの保存先：トレーニングの進捗や結果を保存するログファイルのディレクトリ。 |
| `model_save_dir`| モデルの保存先：トレーニング後のモデルの重みを保存するディレクトリ。 |

## 7. 手順

### 7.1. 

### 7.1. 訓練コードの実行

1. 訓練コードの実行：

```console
$ python3 main.py --mode train
```

- 訓練中にはログ情報がターミナルに表示されます。
- 訓練の進行状況や各エポックごとの訓練損失、テスト精度などが表示されます。

2. 訓練結果の詳細：
- 訓練が完了すると、トレーニング済みモデルが以下のディレクトリに保存されます。
  ```
  [プロジェクトフォルダのパス]/outputs/saved_models/[モデルバージョン]
  ```
- 訓練結果は`training_losses.json`ファイルによって示されます。

### 7.2. テストコードの実行

1. テストコードの実行：
- 特定のモデルバージョンを選択してテストする場合：
  ```console
  $ python3 main.py --mode test --model_version [モデルバージョン]
  ```
- 最新のモデルバージョンを使用してテストする場合：
  ```console
  $ python3 main.py --mode test
  ```

2. テスト結果の詳細：
- テスト結果は2つのメトリクスファイルによって示されます。これらはテストの実行によって生成され、各メトリクスファイルの保存先は`outputs/saved_models/[モデルバージョン]/metrics`ディレクトリ内です。

## 8. その他

### 8.1. ログを確認する

- トレーニングおよびテストの実行中に生成されるログは、`outputs/logs/output.log`ファイルに保存されます。
- 以下のコマンドを使用して、ターミナルでログを表示できます。
 ```console
 $ cat outputs/logs/output.log
 ```

- ログは実行の詳細な情報を提供し、エラーや問題のトラブルシューティングに役立ちます。

以下の表は、ログファイル`(outputs/logs/output.log)`に含まれる情報の一般的な内容を示しています。ログは、実行中の詳細情報やトラブルシューティングの際に参考になる情報が含まれています。

| 情報の種類               | 説明                                                                       |
| ----------------------- | -------------------------------------------------------------------------- |
| エポックごとの進行状況   | 各エポックでのトレーニングとテストの進行状況、精度、損失などの情報が表示されます。 |
| モデルの保存と読み込み   | モデルの保存と読み込みに関する情報が表示され、特定のエポックでのモデルの保存場所やファイル名が記録されます。 |
| エラーメッセージや警告   | 実行中に発生したエラーメッセージや警告が表示され、問題の特定と解決に役立つ情報が提供されます。 |
| 実行中のプロセスに関する情報 | 実行中のさまざまなプロセスに関する情報が表示されます。これには、データの読み込み、モデルのトレーニングなどが含まれます。 |

### 8.2 出力データフォーマット

このセクションでは、プログラムの実行結果および生成されるメトリクスファイルの詳細について説明します。これにより、モデルの性能評価や進捗状況の確認が容易になります。

#### 8.2.1. モデルウェイト

訓練およびテストの結果として、トレーニング済みのモデルが自動的に保存されます。これらのモデルは、各エポックの終了後に生成され、学習中のモデル状態を反映しています。

##### 8.2.1.1. モデルウェイトの保存パス

モデルウェイトの保存場所は、以下のディレクトリ内です。

`outputs/saved_models/[モデルバージョン]`

##### 8.2.1.2. モデルウェイト命名規則

生成される各モデルファイルは、モデルのバージョン、エポック番号、および保存日時に基づいた命名規則に従います。以下の表は、モデルファイルの命名規則の例を示しています。

| ファイル名                                                | 例                                          |
|-----------------------------------------------------------|---------------------------------------------|
| model_version[モデルバージョン]_epoch[エポック番号]_[日付]_[時刻].pt | model_version1_epoch0_2023-08-18_17-06-18.pt |

##### 8.2.1.3. モデル保存ディレクトリ例

例)

```
[プロジェクトフォルダのパス]
└── outputs
   ├── logs
   │   └── output.log
   └── saved_models
       └── 1
           ├── metrics
           │   ├── test_accuracy.json
           │   ├── test_losses.json
           │   └── training_losses.json
           ├── model_version1_epoch10_2023-08-23_17-02-24.pt
           ├── model_version1_epoch1_2023-08-23_17-01-14.pt
           ├── model_version1_epoch2_2023-08-23_17-01-22.pt
           ├── model_version1_epoch3_2023-08-23_17-01-30.pt
           ├── model_version1_epoch4_2023-08-23_17-01-38.pt
           ├── model_version1_epoch5_2023-08-23_17-01-45.pt
           ├── model_version1_epoch6_2023-08-23_17-01-53.pt
           ├── model_version1_epoch7_2023-08-23_17-02-01.pt
           ├── model_version1_epoch8_2023-08-23_17-02-09.pt
           └── model_version1_epoch9_2023-08-23_17-02-16.pt
```

#### 8.2.2. メトリクスファイル

訓練およびテストのメトリクス（損失値や精度など）は、各エポックごとに計算され、メトリクスファイルに保存されます。これにより、モデルの学習や評価の進行状況を可視化できます。メトリクスファイルは、以下のディレクトリ内に保存されます。

##### 8.2.2.1. モデルの保存パス
`outputs/saved_models/[モデルバージョン]/metrics`

##### 8.2.2.2. メトリクスファイルの詳細
以下のメトリクスファイルが生成されます。

| ファイル名               | 内容                                       |
|--------------------------|-------------------------------------------|
| test_accuracy.json       | 各エポックにおけるテスト精度。            |
| test_losses.json         | 各エポックにおけるテスト損失。            |
| training_losses.json     | 各エポックにおけるトレーニング損失。      |

これらのファイルは、モデルの性能評価や学習の進行状況を定量的に分析するための貴重な情報源です。

##### 8.2.2.3. メトリクスファイルの例示
以下は、メトリクスファイルの内容の一部の例です。

- test_accuracy.json
```json
{
    "epoch_1": 0.92,
    "epoch_2": 0.94,
    "epoch_3": 0.95,
    ...
}
```

- test_losses.json
```json
{
    "epoch_1": 0.30,
    "epoch_2": 0.25,
    "epoch_3": 0.20,
    ...
}
```

- training_losses.json
```json
{
    "epoch_1": 0.15,
    "epoch_2": 0.10,
    "epoch_3": 0.08,
    ...
}
```